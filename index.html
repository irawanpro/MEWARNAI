<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <title>Game Mewarnai Buah</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <style>
    /* --- CSS asli kamu tetap sama --- */
    :root { --toolbar-h: 88px; }
    html, body { margin: 0; padding: 0; height: 100%; background: #fff; }
    #stage { position: fixed; inset: 0 0 var(--toolbar-h) 0; background: #fff; overflow: hidden; touch-action: none; }
    canvas { position: absolute; left: 0; top: 0; width: 100%; height: 100%; display: block; }
    #outlineCanvas { pointer-events: none; }
    #topbar { position: fixed; left: 0; right: 0; top: 10px; display: flex; gap: 8px; justify-content: center; align-items: center; z-index: 9999; pointer-events: auto; touch-action: manipulation; }
    .btn { appearance: none; border: none; background: #ff7a00; color: #fff; padding: 10px 14px; border-radius: 10px; font-weight: 700; font-size: 14px; }
    .btn:active { transform: scale(0.98); }
    #fruitName { position: fixed; top: 10px; right: 10px; z-index: 9999; pointer-events: none; font: 700 14px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: rgba(255,255,255,0.9); padding: 8px 10px; border-radius: 10px; border: 1px solid #eee; max-width: 40vw; text-align: center; }
    #toolbar { position: fixed; left: 0; right: 0; bottom: 0; height: var(--toolbar-h); background: #f7f7f7; border-top: 1px solid #e7e7e7; display: grid; grid-template-columns: auto 1fr auto; gap: 10px; align-items: center; padding: 10px 12px; box-sizing: border-box; z-index: 9999; pointer-events: auto; touch-action: manipulation; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    #palette { display: flex; gap: 10px; overflow-x: auto; padding: 4px 0; }
    .swatch { width: 36px; height: 36px; border-radius: 50%; border: 2px solid #222; flex: 0 0 auto; }
    .swatch.selected { outline: 3px solid #9e9e9e; }
    #brushSize { width: 120px; }
    /* Overlay instruksi */
    #instructionOverlay { position: fixed; inset: 0; background: rgba(255,255,255,0.95); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; padding: 20px; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
    #instructionOverlay h1 { font-size: 32px; font-weight: 900; margin: 0 0 8px 0; display: inline-block; padding: 10px 18px; border-radius: 14px; background: linear-gradient(90deg, #ff6b6b 0%, #ffb86b 25%, #ffd56b 50%, #7be495 75%, #6ac8ff 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 1px 0 rgba(255,255,255,0.6), 0 2px 0 rgba(0,0,0,0.08), 0 4px 8px rgba(0,0,0,0.12), 0 8px 20px rgba(0,0,0,0.10); transition: transform 240ms cubic-bezier(.2,.9,.3,1), text-shadow 240ms ease; cursor: default; will-change: transform, text-shadow; box-shadow: 0 6px 18px rgba(107,119,140,0.12), inset 0 -6px 18px rgba(255,255,255,0.06); user-select: none; }
    @keyframes floatSlow { 0% { transform: translateY(0); } 50% { transform: translateY(-6px); } 100% { transform: translateY(0); } }
    #instructionOverlay h1.float { animation: floatSlow 3.6s ease-in-out infinite; }
    #instructionOverlay p { font-size: 16px; color: #333; margin: 6px 0; padding: 6px 10px; border-radius: 10px; background: linear-gradient(180deg, rgba(255,255,255,0.8), rgba(250,250,250,0.9)); box-shadow: 0 4px 10px rgba(16,24,40,0.06), inset 0 -3px 6px rgba(0,0,0,0.02); text-shadow: 0 1px 0 rgba(255,255,255,0.6); user-select: none; }
    #startGameBtn { margin-top: 20px; background: linear-gradient(180deg,#34c759,#13a85a); color: white; border: none; padding: 12px 22px; border-radius: 12px; font-size: 16px; cursor: pointer; font-weight: 800; box-shadow: 0 6px 18px rgba(0,0,0,0.12), inset 0 -6px 12px rgba(255,255,255,0.06); transition: transform 160ms cubic-bezier(.2,.9,.3,1), box-shadow 160ms ease; }
    #startGameBtn:active { transform: translateY(2px) scale(.995); box-shadow: 0 3px 10px rgba(0,0,0,0.10); }
    #startGameBtn:hover { transform: translateY(-6px); box-shadow: 0 12px 28px rgba(0,0,0,0.16); }
    @media (max-width:420px) { #instructionOverlay h1 { font-size: 22px; padding: 8px 12px; } #instructionOverlay p { font-size: 14px; } #startGameBtn { padding: 10px 16px; font-size: 15px; } }
  </style>
</head>
<body>

  <!-- Overlay instruksi -->
  <div id="instructionOverlay">
    <h1 class="float" tabindex="0">Selamat Datang di Game Mewarnai Buah!</h1>
    <p>Created by : GlowandGrow</p>
    <p>Contact person : +6289629065679 / Rahma</p>
    <button id="startGameBtn">Mulai Bermain</button>
  </div>

  <!-- Tombol atas -->
  <div id="topbar">
    <button id="prevBtn" class="btn">Prev</button>
    <button id="resetBtn" class="btn" style="background:#d32f2f">Reset</button>
    <button id="nextBtn" class="btn">Next</button>
  </div>
  <div id="fruitName">Apel</div>

  <!-- Area gambar -->
  <div id="stage">
    <canvas id="paintCanvas"></canvas>
    <canvas id="outlineCanvas"></canvas>
  </div>

  <!-- Toolbar bawah -->
  <div id="toolbar">
    <div style="font-weight:700; padding:0 6px;">Warna</div>
    <div id="palette" aria-label="Palet Warna"></div>
    <input id="brushSize" type="range" min="6" max="48" step="2" value="18" />
  </div>

  <!-- Tambahan audio background -->
  <audio id="bgMusic" loop>
    <source src="assets/audio/background.mp3" type="audio/mpeg">
  </audio>

  <script>
    // === Tambahan untuk instruksi + musik ===
    document.getElementById('startGameBtn').addEventListener('click', function() {
      document.getElementById('instructionOverlay').style.display = 'none';
      document.getElementById('bgMusic').play();
    });

    // ====== Data buah (20 item) ======
    const fruitList = [
      { name: "Apel",      src: "assets/images/apel.png" },
      { name: "Jeruk",     src: "assets/images/jeruk.png" },
      { name: "Anggur",    src: "assets/images/anggur.png" },
      { name: "Kiwi Emas", src: "assets/images/kiwi_emas.png" },
      { name: "Pisang",    src: "assets/images/pisang.png" },
      { name: "Pir",       src: "assets/images/pir.png" },
      { name: "Mangga",    src: "assets/images/mangga.png" },
      { name: "Nanas",     src: "assets/images/nanas.png" },
      { name: "Semangka",  src: "assets/images/semangka.png" },
      { name: "Pepaya",    src: "assets/images/pepaya.png" },
      { name: "Melon",     src: "assets/images/melon.png" },
      { name: "Alpukat",   src: "assets/images/alpukat.png" },
      { name: "Timun",     src: "assets/images/timun.png" },
      { name: "Terong",    src: "assets/images/terong.png" },
      { name: "Labu Siam", src: "assets/images/labu_siam.png" },
      { name: "Cabai",     src: "assets/images/cabai.png" },
      { name: "Tomat",     src: "assets/images/tomat.png" },
      { name: "Paprika",   src: "assets/images/paprika.png" },
      { name: "Zukini",    src: "assets/images/zukini.png" },
      { name: "Kentang",   src: "assets/images/kentang.png" }
    ];

    const paintCanvas   = document.getElementById('paintCanvas');
    const outlineCanvas = document.getElementById('outlineCanvas');
    const paintCtx      = paintCanvas.getContext('2d');
    const outlineCtx    = outlineCanvas.getContext('2d');
    const fruitNameEl   = document.getElementById('fruitName');
    const prevBtn       = document.getElementById('prevBtn');
    const nextBtn       = document.getElementById('nextBtn');
    const resetBtn      = document.getElementById('resetBtn');
    const paletteEl     = document.getElementById('palette');
    const brushSizeEl   = document.getElementById('brushSize');

    let currentFruitIndex = 0;
    let drawing = false;
    let lastX = 0, lastY = 0;
    let brushColor = '#ff3b30';
    let brushSize  = parseInt(brushSizeEl.value, 10);

    const paletteColors = [
      '#ff3b30','#ff9500','#ffcc00','#34c759','#0a84ff','#af52de',
      '#6d6d6d','#000000','#ffffff','#a0522d'
    ];

    function fitCanvases() {
      const rect = document.getElementById('stage').getBoundingClientRect();
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      [paintCanvas, outlineCanvas].forEach(cv => {
        cv.width  = Math.floor(rect.width * dpr);
        cv.height = Math.floor(rect.height * dpr);
        cv.style.width  = rect.width + 'px';
        cv.style.height = rect.height + 'px';
      });
      paintCtx.setTransform(1,0,0,1,0,0);
      outlineCtx.setTransform(1,0,0,1,0,0);
      paintCtx.scale(dpr, dpr);
      outlineCtx.scale(dpr, dpr);
      drawOutline();
    }

    const outlineImg = new Image();
    outlineImg.onload = drawOutline;

    function drawOutline() {
      const w = outlineCanvas.clientWidth;
      const h = outlineCanvas.clientHeight;
      outlineCtx.clearRect(0, 0, w, h);
      if (!outlineImg.naturalWidth) return;
      const imgW = outlineImg.naturalWidth, imgH = outlineImg.naturalHeight;
      const stageW = outlineCanvas.clientWidth, stageH = outlineCanvas.clientHeight;
      const imgRatio = imgW / imgH, stageRatio = stageW / stageH;
      let drawW, drawH, dx, dy;
      if (imgRatio > stageRatio) {
        drawW = stageW; drawH = drawW / imgRatio;
        dx = 0; dy = (stageH - drawH) / 2;
      } else {
        drawH = stageH; drawW = drawH * imgRatio;
        dy = 0; dx = (stageW - drawW) / 2;
      }
      outlineCtx.drawImage(outlineImg, dx, dy, drawW, drawH);
    }

    function clearPaint() {
      paintCtx.clearRect(0, 0, paintCanvas.clientWidth, paintCanvas.clientHeight);
    }

    function loadFruit(index) {
      currentFruitIndex = (index + fruitList.length) % fruitList.length;
      fruitNameEl.textContent = fruitList[currentFruitIndex].name;
      clearPaint();
      outlineImg.src = fruitList[currentFruitIndex].src;
    }

    function buildPalette() {
      paletteEl.innerHTML = '';
      paletteColors.forEach((c, i) => {
        const sw = document.createElement('button');
        sw.className = 'swatch' + (i===0?' selected':'');
        sw.style.background = c;
        sw.addEventListener('click', (e) => {
          e.stopPropagation(); brushColor = c;
          document.querySelectorAll('.swatch').forEach(x=>x.classList.remove('selected'));
          sw.classList.add('selected');
        });
        sw.addEventListener('touchend', (e) => {
          e.preventDefault(); e.stopPropagation();
          sw.click();
        }, { passive:false });
        paletteEl.appendChild(sw);
      });
    }

    function getPos(e) {
      const rect = paintCanvas.getBoundingClientRect();
      let x, y;
      if (e.touches && e.touches.length) {
        x = e.touches[0].clientX - rect.left;
        y = e.touches[0].clientY - rect.top;
      } else {
        x = e.clientX - rect.left;
        y = e.clientY - rect.top;
      }
      return { x, y };
    }

    function startDraw(e) {
      e.preventDefault();
      drawing = true;
      paintCtx.beginPath();
      const p = getPos(e);
      paintCtx.moveTo(p.x, p.y);
      lastX = p.x; lastY = p.y;
    }
    function moveDraw(e) {
      if (!drawing) return;
      const p = getPos(e);
      paintCtx.lineCap = 'round';
      paintCtx.lineJoin = 'round';
      paintCtx.strokeStyle = brushColor;
      paintCtx.lineWidth = brushSize;
      paintCtx.lineTo(p.x, p.y);
      paintCtx.stroke();
      lastX = p.x; lastY = p.y;
    }
    function endDraw(e) {
      if (!drawing) return;
      drawing = false;
      paintCtx.closePath();
    }

    paintCanvas.addEventListener('touchstart', startDraw, { passive:false });
    paintCanvas.addEventListener('touchmove',  moveDraw,  { passive:false });
    paintCanvas.addEventListener('touchend',   endDraw,   { passive:false });
    paintCanvas.addEventListener('touchcancel',endDraw,   { passive:false });
    paintCanvas.addEventListener('mousedown',  startDraw);
    window.addEventListener('mousemove',       moveDraw);
    window.addEventListener('mouseup',         endDraw);

    function bindButton(el, handler) {
      el.addEventListener('click', (e)=>{ e.stopPropagation(); handler(); });
      el.addEventListener('touchend', (e)=>{ e.preventDefault(); e.stopPropagation(); handler(); }, { passive:false });
    }
    bindButton(nextBtn, ()=> loadFruit(currentFruitIndex + 1));
    bindButton(prevBtn, ()=> loadFruit(currentFruitIndex - 1));
    bindButton(resetBtn,()=> clearPaint());

    brushSizeEl.addEventListener('input', ()=> { brushSize = parseInt(brushSizeEl.value,10); });

    buildPalette();
    window.addEventListener('resize', fitCanvases);
    fitCanvases();
    loadFruit(0);
  </script>
</body>
</html>
